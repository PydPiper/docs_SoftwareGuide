

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.4. builtin - Context Manager &mdash; Viktor&#39;s Software Guide 2019 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1.5. builtin - Copy True/Shallow/Deep" href="builtin_copy.html" />
    <link rel="prev" title="1.3. builtin - Tuples, Lists, Sets, Dictionaries" href="builtin_containers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Viktor's Software Guide
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">1. Python Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="10min_python_starters_kit.html">1.1. 10min - Python Starter Kit</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtin_class.html">1.2. builtin - Class (Object Oriented Programming)</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtin_containers.html">1.3. builtin - Tuples, Lists, Sets, Dictionaries</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.4. builtin - Context Manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#object-oriented-version">1.4.1. Object Oriented Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functional-programming-version">1.4.2. Functional Programming Version</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="builtin_copy.html">1.5. builtin - Copy True/Shallow/Deep</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtin_functions.html">1.6. builtin - Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtin_IO.html">1.7. builtin - File Input/Output (IO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtin_logic_loops.html">1.8. builtin - Logic Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtin_mutable.html">1.9. builtin - Mutable/Immutable</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtin_strings.html">1.10. builtin - Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtin_user_inputs.html">1.11. builtin - User Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_pyinstaller.html">1.12. lib - pyinstaller</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_pyqt.html">1.13. lib - PyQt5 (GUI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_pytest.html">1.14. lib - pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_sphinx.html">1.15. lib - Sphinx (code documentation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_subprocess.html">1.16. lib - Subprocess</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_virtualenv.html">1.17. lib - virtualenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool_git.html">1.18. tool - Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool_pip.html">1.19. tool - pip (Package Installer for Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool_pycharm.html">1.20. tool - PyCharm (IDE)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../VBA/index.html">2. VBA Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Shell/index.html">3. Shell Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Viktor's Software Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">1. Python Guide</a> &raquo;</li>
        
      <li>1.4. builtin - Context Manager</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/python/builtin_context_manager.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="builtin-context-manager">
<h1>1.4. builtin - Context Manager<a class="headerlink" href="#builtin-context-manager" title="Permalink to this headline">¶</a></h1>
<p>Context Manager is a function or class that has an “Enter” buildup code, and an
“Exit” teardown code that the user is able simply call in a “with” block. The most
common example of this is the builtin file IO class “open”. Open has an “Enter” that
opens file streaming and an “Exit” that safely closes the file for streaming.</p>
<div class="section" id="object-oriented-version">
<h2>1.4.1. Object Oriented Version<a class="headerlink" href="#object-oriented-version" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Setup</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># context manager setup</span>
<span class="k">class</span> <span class="nc">MyContextManager</span><span class="p">():</span>

    <span class="c1"># predefine input on &quot;with&quot; code line</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preload</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;context initialized on runtime&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preload</span> <span class="o">=</span> <span class="n">preload</span>

    <span class="c1"># enter method is called when the code enters the with block</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;inside with block&quot;</span><span class="p">)</span>
        <span class="c1"># keep the context manager class simple</span>
        <span class="c1">#   by returning another class that does the work from the __enter__ block</span>
        <span class="c1"># When a &quot;with MyContextManger(10) mycont:&quot; is called,</span>
        <span class="c1">#   we are really saying that mycont = worker_class(10)</span>
        <span class="k">return</span> <span class="n">worker_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preload</span><span class="p">)</span>

    <span class="c1"># exit method is called when the code exits the with block</span>
    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span><span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="c1"># exc_type ==&gt; exception type (ie. TypeError, ValueError, KeyError)</span>
        <span class="c1"># exc_val  ==&gt; raise exception argument (ie. TypeError(&quot;this is the exc_val&quot;))</span>
        <span class="c1"># exc_tb   ==&gt; traceback message (where the in the code did the exception occur)</span>

        <span class="c1"># exit method receives arg containing details of exception raised in the &quot;with&quot; block</span>
        <span class="c1">#   if context can handlethe exception, __exit__() should return a true</span>
        <span class="c1">#   (ie. error does not need to be propagated)</span>
        <span class="c1">#   returning false causes the exception to be re-raised after __exit__()</span>

        <span class="c1"># this feature is really nice when trying to graciously handle exceptions</span>
        <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;handled ValueError, raised exception value = &quot;</span><span class="p">,</span><span class="n">exc_val</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Extend the context manger functionality</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define worker class</span>
<span class="k">class</span> <span class="nc">worker_class</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preload</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preload</span> <span class="o">=</span> <span class="n">preload</span>
    <span class="k">def</span> <span class="nf">extended</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">preload</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>How to use it</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># now to use it</span>
<span class="k">with</span> <span class="n">MyContextManager</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">mycont</span><span class="p">:</span>
    <span class="c1"># code without any errors</span>
    <span class="n">mycont</span><span class="o">.</span><span class="n">extended</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="s2">&quot;context initialized on runtime&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s2">&quot;inside with block&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span>

<span class="c1"># how it works with handled error</span>
<span class="k">with</span> <span class="n">MyContextManager</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">mycont</span><span class="p">:</span>
    <span class="c1"># code without any errors</span>
    <span class="n">mycont</span><span class="o">.</span><span class="n">extended</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;HI!&quot;</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="s2">&quot;context initialized on runtime&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s2">&quot;inside with block&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s2">&quot;handled ValueError, raised exception value =  HI!&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="functional-programming-version">
<h2>1.4.2. Functional Programming Version<a class="headerlink" href="#functional-programming-version" title="Permalink to this headline">¶</a></h2>
<p>We can accomplish the same task with a function definition as shown above and a library called
contextlib</p>
<ul class="simple">
<li><p>Define the worker class (same as above, this does not have to be a class object, this example
is simply reusing the same code as above for clarity)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define worker class (same as above)</span>
<span class="k">class</span> <span class="nc">worker_class</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preload</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preload</span> <span class="o">=</span> <span class="n">preload</span>
    <span class="k">def</span> <span class="nf">extended</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">preload</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Setup the context manager function</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">MyContextManager</span><span class="p">(</span><span class="n">preload</span><span class="p">):</span>
    <span class="c1"># __init__ code goes here</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;context initialized on runtime&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;inside with block&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">worker_class</span><span class="p">(</span><span class="n">preload</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;handled ValueError, raised exception value = &quot;</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># __exit__ code goes here</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;__exit__ cleanup code goes here&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Use it</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">MyContextManager</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">mycont</span><span class="p">:</span>
    <span class="c1"># code without any errors</span>
    <span class="n">mycont</span><span class="o">.</span><span class="n">extended</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="s2">&quot;context initialized on runtime&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s2">&quot;inside with block&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s2">&quot;__exit__ cleanup code goes here&quot;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="builtin_copy.html" class="btn btn-neutral float-right" title="1.5. builtin - Copy True/Shallow/Deep" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="builtin_containers.html" class="btn btn-neutral float-left" title="1.3. builtin - Tuples, Lists, Sets, Dictionaries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Viktor Kis

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>